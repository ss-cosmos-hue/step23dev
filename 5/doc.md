# 現状の観察
## 値
| best score | 3,291.62	| 3,778.72	| 4,494.42	| 8,233.56	| 10,635.22	| 21,191.89	| 42,187.11
| ----	| ----	| ----	| ----	| ----	| ----	| ---- | ---- |
| greedy | 3,418.10  |  3,832.29 | 5,449.44 | 10,519.16 | 12,684.06 | 25,331.84 | 49,892.05 |
| sa  | 3,291.62  |  3,778.72 | 4,494.42 | 8,150.91 | 10,675.29 | 21,119.55 | 44,393.89 |
- greedy は　best scoreとオーダーはおなじで，一桁目は一緒
- -> 今回のデータセットに対しては，greedyを改変することで，best scoreに近づけることができそう！
## 図
![貪欲法i=3](image.png)

- 交差がある
    -  -> 交差をなくせばよい
    - -> 交差を見つけて，swapすればいい
    - 交差をみつける
        - ふわっと）線を新たに引くとき，今までのものに交わっていたら，
        - 実装）今までのエッジを保持しておいて，greedy法により，AからBへ線をあらたに引こうとするとき，線分ABと交わるエッジが今までのエッジの中にあるかどうか調べる。（複数あるかもしれない）
    - swapする
        - ふわっと）対角線がきまっている台形の，向かい合う二辺は二組あるが，一方を選ぶと島が途切れてしまう場合があるのが避けたいこと。
        - 実装）線分A->Bを引くとき，もとのエッジC->Dに被ってしまったとする。...C,D.....A,Bのかわりに，...C,A....D,Bとするのに加えて，AとDの間におとずれていたエッジをひっくり返す必要がある。そして，エッジの集合を更新する。交差が複数生じた場合は，そもそも厳密解ではなくヒューリスティックなので初めに見つけた方を選んでも良いし，もしくは，交差がなくなるまで，swapを続けても良い
- 帰りが長い
    - 反対向きに辿って重ね合わせる？
# 行ったこと
1.  貪欲法を用いて経路を探す。あたらしいノードをpathに加える際，今までのエッジEi(node_s,node_e)を見ていき，
distance(node_s,node_e)+distance(あたらしいエッジ)と，
distance(node_s,一つ前のノード)+distance(node_e,あたらしいノード)を比較して，
後者の方が短ければ経路を繋ぎ変える。
![貪欲法+工夫i=3](image2.png)
※実装上，完全に交差をなくしているわけではない。順に見て，交差を解消したほうが改善されるときのみ解消している。

2.  焼き鈍し法
ある経路に対し，エッジを取り替える変更を行ったもののなかで，経路が短いものkこをk近傍と呼ぶ。
そのなかからランダムに経路を選び，以前と改善されていれば変更，以前より改悪でも一定の割合で採用する。

# 6thweek
| method | challenge0 | challenge1 | challenge2 | challenge3 | challenge4 | challenge5 | challenge6 | challenge7 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| greedy | 3418.10 | 3832.29 | 5449.44 | 10519.16 | 12684.06 | 25331.84 | 49892.05 | 95983.29 |
| 2-opt ver1 | 3418.10 | 3832.29 | 5232.96 | 9825.02 | 11766.38 | 24084.79 | 47261.33 | --- |
| sa ver1 | 3291.62 | 3832.29 | 5232.96 | 9825.02 | 11766.38 | 22894.91  | 47261.33 | --- |
| 2-opt ver2 | 3418.10 | 3832.29 | 5011.40 |  9660.48 |  11799.59 | 23887.73 | 45484.91 | 88029.76 |
| 2-opt ver3 | 3418.10 | 3832.29 | 5011.40 | 8970.05 | 11501.40 | 21389.71 | 42712.37 | 84190.72 |
| 2-opt ver4 | 3418.10 | 3832.29 | 4656.80 | 8925.75 | 11323.84 | 21295.89 | 42660.76 | 84444.48 |
*2-opt ver2は、貪欲法で全体の経路を求めたあとに、2-optを適用する
*2-opt ver3は、さらに、two-optを、改善がみられなくなるまで繰り返し適用する。
*2-opt ver4は、さらに、始点を左上にして開始する。
なお、貪欲法により、始点が左上でも、解が改善しない場合がある。

![greedy](%E7%9B%B4%E7%B7%9A%E9%83%A8%E5%88%86%E3%81%8C%E6%AE%8B%E3%82%8B.png)
![two opt](%E7%9B%B4%E7%B7%9A%E3%81%AE%E3%81%93%E3%82%8Btwo-opt.png)

直線が残る部分に関して、
- 2-optを繰り返す
- 領域を分割するのもあり
- 初期の値をかえるのもあり
- 焼き鈍し法を使うのもあり、

## 2-optを繰り返し適用した場合
値が改善しなくなるまで、2-optの適用を繰り返した。
| 2-opt iteration | challenge0 | challenge1 | challenge2 | challenge3 | challenge4 | challenge5 | challenge6 | challenge7 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| count | 1 | 1 | 2 | 3 | 4 | 7 | 6 | 8 |

![two opt ver3](solver2_opt_ver3_n512.png)

## スタート地点を端っこにする
スタート地点として、左上の市を選択し、そこから貪欲法でルートを求め、あとは同様に2-optを適用した。
![two opt ver4](2opt_start_from_corner_diagon.png)
このように斜めに伸びてしまうことが観察された。密な配置なので大きな問題ではないかもしれない。
斜めに伸びるのを解消するには、領域に区切るのもありかもしれない。

## 局所解にいよいよ陥ってきたので、saを用いよう。
今までの最短経路（局所解に陥っている）からはじめるのがよいのか？
それとも適当な箇所から始めるのがよいのか？(greedy あるいはrandom)